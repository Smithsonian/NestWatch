# Migration configuration for NW Birds Data. 

id: capture_data
label: Importing capture data. 
migration_group: nestwatch
migration_tags:
  - nestwatch migrate birds
source:
  plugin: csv
  path: 'public://import/captures_backup.csv'
  header_row_count: 1
  keys:
    - captureID
  fields:
    captureID: captureID
    siteID: siteID
    spp : spp
    bandNumber : bandNumber
    colorCombo : colorCombo
    date: date
    time: time
    enc: enc
    mass : mass
    wing : wing
    tl : tl
    age : age
    sex : sex
    fat : fat
    cpBp : cpBp
    featherID : featherID
    bloodID : bloodID
    notes: notes

destination:
  plugin: 'entity:node'
  default_bundle: capture

process:
  title: captureID
  field_capture_bird_age : age
  field_capture_bird_cpbp : cpBp
  # We will use concat plugin to combine the date and time columns into one entry 
  # and the format_date plugin to format the concated entry into a date readable by drupal

  field_capture_date_time :
    -
      plugin: concat
      source: 
        - date
        - time
      delimiter: ' '
    -
      plugin: format_date
      from_format: 'Y-m-d Hi'
      to_format: 'Y-m-d\TH:i:s'
  
  field_capture_bird_fat : fat
  field_capture_bird_mass : mass
  field_capture_encounter_type : enc
  field_capture_bird_tail_span : tl
  field_capture_bird_wing_span : wing
  field_capture_notes: notes
  
  # Use the entity lookup plugin to look for referenced sites
  field_capture_site_id : 
    plugin: entity_lookup
    source: siteID
    value_key: name
    entity_type: user
    ignore_case: true
  
  
  # Use the entity lookup plugin to look for referenced birds
  field_capture_bird_id : 
    plugin: entity_lookup
    source: bandNumber
    value_key: title
    entity_type: node
    bundle: bird
    ignore_case: true


dependencies:
  enforced:
    module:
      - nestwatch_migrate
