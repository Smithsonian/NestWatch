# Migration configuration for NW Birds Data. 

id: birds_data
label: Importing birds data. 
migration_group: nestwatch
migration_tags:
  - nestwatch migrate birds
source:
  plugin: csv
  path: 'public://import/captures_backup.csv'
  header_row_count: 1
  keys:
    - bandNumber
  fields:
    spp : spp
    bandNumber : bandNumber
    colorCombo : colorCombo
    date: date
    time: time
    mass : mass
    wing : wing
    tl : tl
    age : age
    sex : sex
    fat : fat
    cpBp : cpBp
    featherID : featherID
    bloodID : bloodID

destination:
  plugin: 'entity:node'
  default_bundle: bird

process:
  title: bandNumber
  field_bird_age : age
  field_bird_band_color_combo : colorCombo
  field_bird_band_number : bandNumber
  field_bird_cpbp : cpBp

  # We will use concat plugin to combine the date and time columns into one entry 
  # and the format_date plugin to format the concated entry into a date readable by drupal

  field_bird_date_captured :
    -
      plugin: concat
      source: 
        - date
        - time
      delimiter: ' '
    -
      plugin: format_date
      from_format: 'Y-m-d Hi'
      to_format: 'Y-m-d\TH:i:s'
  
  field_bird_fat : fat
  field_bird_mass : mass
  field_bird_sex : sex

  # Use the entity lookup plugin to look for referenced species by the field_specis_sppcode. 

  field_bird_species : 
    plugin: entity_lookup
    source: spp
    value_key: field_species_sppcode
    bundle_key: vid
    bundle: bird_species
    entity_type: taxonomy_term
    ignore_case: true

  field_bird_tail_span : tl
  field_bird_wing_span : wing


dependencies:
  enforced:
    module:
      - nestwatch_migrate
